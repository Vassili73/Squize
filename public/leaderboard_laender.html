<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Flag Icon CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">

    <script src="js/utils.js"></script>
    <script src="js/jquery.min.js"></script>

    <title>Leaderboard</title>
</head>

<body>
<div class="container py-3">
    <header>
        <div class="d-flex flex-column flex-md-row align-items-center p-3 mb-4 border-bottom" id="navContainer">
            <a href="/"><img style="width: 40px;" src="./favicon.ico" alt=""></a>
            <a class="text-decoration-none link-body-emphasis" href="/"><h5 class="my-0 mr-md-auto font-weight-normal">Squize</h5></a>
        </div>
    </header>

    <main>
        <div class="p-3 pb-md-4 mx-auto text-center">
            <h1 class="display-4 fw-normal text-body-emphasis">Leaderboard</h1>
        </div>

        <div class="row">
            <div class="col-md-3">
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" aria-current="page" href="/leaderboard"> 
                            Globale Rangliste
                        </a>
                    </li>
                    <li>
                        <a class="nav-link active" href="leaderboard_laender">
                            LÃ¤nder Rangliste
                        </a>
                    </li>
                </ul>
            </div>
            <div class="col-md-9">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th scope="col">Rang</th>
                            <th scope="col">Name</th>
                            <th scope="col">Punkte</th>
                            <th scope="col">Prozent</th>
                        </tr>
                        </thead>
                        <tbody id="leaderboardTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2024 Squize Team</p>
        <ul class="list-inline">
            <li class="list-inline-item"><a href="/impressum">Impressum</a></li>
            <li class="list-inline-item"><a target="_blank" href="https://github.com/DerEchteJoghurt/Squize">GitHub</a></li>
        </ul>
    </footer>
</div>

<script type="module" src="js/main.js"></script>
<script>
  $(document).ready(function() {
    var user_id = -1;
    checkCurrentUser(function(user) {
        if (user) {
            console.log(user);
            let nav = $('#navContainer').html();
            nav += '<nav class="d-inline-flex mt-2 mt-md-0 ms-md-auto">'
            nav += '<a class="btn btn-outline-primary" href="/profile">' + user.username + '\'s Profile</a>'
            nav += '</nav>'
            $('#navContainer').html(nav);
            user_id = user.id;
        } else {
            let nav = $('#navContainer').html();
            nav += '<nav class="d-inline-flex mt-2 mt-md-0 ms-md-auto">'
            nav += '<a class="me-3 py-2 link-body-emphasis text-decoration-none" href="/login">Login</a>'
            nav += '</nav>'
            nav += '<a class="btn btn-outline-primary" href="/register"">Register</a>'
            $('#navContainer').html(nav);
        }

        $.ajax({
            url: 'http://localhost:3000/api/leaderboard/DE',
            method: 'GET',
            contentType: 'application/json; charset=utf-8',
            cache: false,
            dataType: 'json'
        }).done(function (response) {
            let content = '';
            let rank = 1;

            for (let entry of response) {
                if (entry.user.user_id === user_id) {
                    content += '<tr class="table-primary">';
                } else {
                    content += '<tr">';
                }
                content += '<td>#' + rank + '</td>';
                content += '<td><span class="flag-icon flag-icon-' + entry.user.country.toLowerCase() + '"></span> ' + entry.user.username + '</td>';
                content += '<td>' + entry.score + '</td>';
                content += '<td>' + entry.percentage + '%</td>';
                content += '</tr>';

                rank++;
            }

            $('#leaderboardTableBody').html(content);
        }).fail(function (jqXHR, statusText, error) {
            alert(jqXHR.responseText);
        });
    });
  });
</script>
</body>
</html>








 

